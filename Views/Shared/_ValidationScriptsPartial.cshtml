<script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
<script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>
<script>
    // Custom validation methods
    $.validator.addMethod('date', function (value, element) {
        if (this.optional(element)) {
            return true;
        }

        var valid = true;
        try {
            $.datepicker.parseDate('mm/dd/yy', value);
        }
        catch (err) {
            valid = false;
        }

        return valid;
    });

    // File size validation
    $.validator.addMethod('filesize', function (value, element, params) {
        if (this.optional(element)) {
            return true;
        }

        if (element.files.length > 0) {
            const fileSize = element.files[0].size;
            const maxSize = params * 1024 * 1024; // Convert MB to bytes
            return fileSize <= maxSize;
        }

        return true;
    }, function (params, element) {
        return 'File size must not exceed ' + params + ' MB.';
    });

    // Add custom validation attributes
    $.validator.unobtrusive.adapters.add('filesize', ['maxsize'], function (options) {
        options.rules['filesize'] = options.params.maxsize;
        options.messages['filesize'] = options.message;
    });

    // Make validation more user-friendly
    $(document).ready(function () {
        // Highlight error fields with bootstrap classes
        $.validator.setDefaults({
            highlight: function (element) {
                $(element).addClass('is-invalid');
            },
            unhighlight: function (element) {
                $(element).removeClass('is-invalid');
            },
            errorElement: 'div',
            errorClass: 'invalid-feedback',
            errorPlacement: function (error, element) {
                if (element.parent('.input-group').length) {
                    error.insertAfter(element.parent());
                } else {
                    error.insertAfter(element);
                }
            }
        });
    });
</script>